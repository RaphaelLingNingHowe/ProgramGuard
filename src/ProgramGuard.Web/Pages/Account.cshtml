@page
@using ProgramGuard.Dtos.Account
@model ProgramGuard.Web.Pages.AccountModel
@{
    ViewData["Title"] = "Account";
}

<!--- Razor 預設開啟 AntiForgeryToken 這個會影響 Post, Put, Patch, Delete 等行為 !--->
@Html.AntiForgeryToken()

<h1>用戶管理系統</h1>

<div id="gridContainer">
    @(
        Html.DevExtreme().DataGrid<GetUserDto>()
        .DataSource(o => o.RemoteController()
        .LoadUrl("Account?Handler=Data")
        .InsertUrl("Account")
        .UpdateUrl("Account")
        .Key("RoleName"))
        .Editing(e =>
                {
                    e.AllowUpdating(true);
                    e.Mode(GridEditMode.Batch);
                    e.UseIcons(true);
                })
        .Columns(columns =>
        {
            columns.AddFor(m => m.UserName).AllowEditing(false); 
            columns.AddFor(m => m.RoleName);
            columns.AddFor(m => m.LoginStatus).AllowEditing(false);
            columns.AddFor(m => m.LoginTime).Format("yyyy-MM-dd HH:mm:ss").AllowEditing(false); 
            columns.AddFor(m => m.LogoutTime).Format("yyyy-MM-dd HH:mm:ss").AllowEditing(false); 
            columns.AddFor(m => m.LockoutEnabled);
            columns.AddFor(m => m.LockoutEnd).Format("yyyy-MM-dd HH:mm:ss").AllowEditing(false);
            columns.AddFor(m => m.AccessFailedCount).AllowEditing(false);
            columns.AddFor(m => m.IsFrozen);
        })
        .ShowBorders(true)
        .ColumnAutoWidth(true)
        .Selection(o => o.Mode(SelectionMode.Single))
        .NoDataText("沒有資料")
        .HoverStateEnabled(true)
        .FocusedRowEnabled(true)
        .Paging(paging => paging.PageSize(15))
        .Pager(pager =>
        {
            pager.Visible(true);
            pager.DisplayMode(GridPagerDisplayMode.Full);
            pager.ShowPageSizeSelector(true);
            pager.AllowedPageSizes(new JS("[15, 30, 50, 100, 200]"));
            pager.ShowInfo(true);
            pager.ShowNavigationButtons(true);
        })
        )
</div>

<script>
    /* 配合 AntiForgeryToken 使用 */
    $.ajaxSetup({
        data: {
            __RequestVerificationToken: document.getElementsByName("__RequestVerificationToken")[0].value
        }
    });
</script>

