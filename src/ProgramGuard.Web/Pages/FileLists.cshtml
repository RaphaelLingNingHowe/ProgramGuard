@page
@model ProgramGuard.Web.Pages.FileListsModel
@using DevExtreme.AspNet.Mvc
@using ProgramGuard.Dtos.FileDetection
@{
    ViewData["Title"] = "檔案清單";
}

<!--- Razor 預設開啟 AntiForgeryToken 這個會影響 Post, Put, Patch, Delete 等行為 !--->
@Html.AntiForgeryToken()

@using (Html.BeginForm(FormMethod.Post))
{
    <div class="dx-field">
        <div class="dx-field-label">檔案路徑</div>
        <div class="dx-field-value">
            @(Html.DevExtreme().TextBox()
                .Name("FilePath")
                .Placeholder("輸入檔案路徑")
                )
        </div>
    </div>
    <div class="dx-field">
        <div class="dx-field-value">
            @(Html.DevExtreme().Button()
                .Text("確認")
                .Type(ButtonType.Success)
                .UseSubmitBehavior(true)
                .OnClick("showSuccessMessage")
                )
        </div>
    </div>
}


<div id="gridContainer">
    @(
        Html.DevExtreme().DataGrid<FileListDto>()
        .DataSource(o => o.RemoteController()
        .LoadUrl("FileLists?Handler=Data")
        .InsertUrl("FileLists")
        .UpdateUrl("FileLists")
        .DeleteUrl("FileLists")
        .Key("Id"))
        .Columns(columns =>
        {
            columns.AddFor(m => m.FileName).Caption("檔案名稱");

            columns.AddFor(m => m.FilePath).Caption("檔案路徑");
        })
        .Editing(editing =>
        {
            editing.Mode(GridEditMode.Row);
            editing.AllowUpdating(true);
            editing.AllowDeleting(true);
            editing.UseIcons(true);
        })
        .ShowBorders(true)
        .ColumnAutoWidth(true)
        .Selection(o => o.Mode(SelectionMode.Single))
        .NoDataText("沒有資料")
        .HoverStateEnabled(true)
        .FocusedRowEnabled(true)
        .Paging(paging => paging.PageSize(15))
        .Pager(pager =>
        {
            pager.Visible(true);
            pager.DisplayMode(GridPagerDisplayMode.Full);
            pager.ShowPageSizeSelector(true);
            pager.AllowedPageSizes(new JS("[15, 30, 50, 100, 200]"));
            pager.ShowInfo(true);
            pager.ShowNavigationButtons(true);
        })
        )
</div>

<script>
    /* 配合 AntiForgeryToken 使用 */
    $.ajaxSetup({
        data: {
            __RequestVerificationToken: document.getElementsByName("__RequestVerificationToken")[0].value
        }
    });
        function showSuccessMessage(e) {

            var notify = DevExpress.ui.notify({
                message: "檔案添加成功",
            });
        }
</script>

