@page
@model ProgramGuard.Web.Pages.FileListsModel
@using DevExtreme.AspNet.Mvc
@using ProgramGuard.Dtos.FileDetection
@{
    ViewData["Title"] = "File Lists";
}

<!--- Razor 預設開啟 AntiForgeryToken 這個會影響 Post, Put, Patch, Delete 等行為 !--->
@Html.AntiForgeryToken()

<h1>Create File Lists</h1>

@using (Html.BeginForm(FormMethod.Post))
{
    <div class="dx-field">
        <div class="dx-field-label">File Path:</div>
        <div class="dx-field-value">
            @(Html.DevExtreme().TextBox()
                .Name("FilePath")
                .Placeholder("Enter file path")
                )
        </div>
    </div>
    <div class="dx-field">
        <div class="dx-field-value">
            @(Html.DevExtreme().Button()
                .Text("Create")
                .Type(ButtonType.Success)
                .UseSubmitBehavior(true)
                )
        </div>
    </div>
}

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success" role="alert">
        @TempData["SuccessMessage"]
    </div>
}

<h1>File Lists</h1>

<div id="gridContainer">
    @(
        Html.DevExtreme().DataGrid<FileListDto>()
        .DataSource(o => o.RemoteController()
        .LoadUrl("FileLists?Handler=Data")
        .InsertUrl("FileLists")
        .UpdateUrl("FileLists")
        .DeleteUrl("FileLists")
        .Key("Id"))
        .Columns(columns =>
        {
            columns.AddFor(m => m.FileName);

            columns.AddFor(m => m.FilePath);
        })
        .Editing(editing =>
        {
            editing.Mode(GridEditMode.Row);
            editing.AllowUpdating(true);
            editing.AllowDeleting(true);
            editing.UseIcons(true);



        })
        .ShowBorders(true)
        .ColumnAutoWidth(true)
        .Selection(o => o.Mode(SelectionMode.Single))
        .NoDataText("沒有資料")
        .HoverStateEnabled(true)
        .FocusedRowEnabled(true)
        .Paging(paging => paging.PageSize(15))
        .Pager(pager =>
        {
            pager.Visible(true);
            pager.DisplayMode(GridPagerDisplayMode.Full);
            pager.ShowPageSizeSelector(true);
            pager.AllowedPageSizes(new JS("[15, 30, 50, 100, 200]"));
            pager.ShowInfo(true);
            pager.ShowNavigationButtons(true);
        })
        )
</div>

<script>
    /* 配合 AntiForgeryToken 使用 */
    $.ajaxSetup({
        data: {
            __RequestVerificationToken: document.getElementsByName("__RequestVerificationToken")[0].value
        }
    });
</script>

